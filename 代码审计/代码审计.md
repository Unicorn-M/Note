# 代码审计

## 第一天

###1.安全工程师的核心

<h4 style="color:red;">对于安全理解的深度,以及由此引申的看待安全问题的角度和高度</h4>

### 2.安全的本质是什么？

<h4 style="color:red;">信任问题</h4>

<p>一切的安全方案设计的基础,都是建立在信任关系上的。我们必须要相信一些东西，必须要有一些最基本的假设，安全方案才能得以建立。反之，如果我们否定一切，安全方案就会变成无源之水、无本之木、无法设计也无法完成。</p>

```思考
1.是否信任用户的输入?
	如果完全信任用户的输入,不做任何处理,就会造成前台漏洞
	比如:我们不把数据做任何处理,就放进数据库,就可能造成sql注入。
		如果不把数据做任何处理,就当做代码执行,就会造成rec漏洞
2.是否该信任管理员用户的输入?
	如果完全信任管理员用户,管理员用户可能因为弱口令或者XSS钓鱼,造成后台漏洞
3.是否该信任升级包、离线升级、在线升级、自动化升级?
	如果完全信任这些就会造成供应链攻击。比如如果黑客一来就攻击你的镜像仓库,那么你整个生产环境因为拉取了代码，导致整个环境都被污染了。
4.我们是否不信任任何输入(对上面说的所以东西都进行检测)	
	这个时候我们信任的就是我们的检测逻辑，就引出了我们的代码审计。
	我们就是在和输入检测逻辑进行对抗

```

### 3.安全方案模型

<h4 style="color:red;">所有的安全模型最后都会抽象为一个模型: 输入 -> 检测恶意流量 -> 输出可信任流量
</h4>

```常见的安全模型
NDR: 
	输入: 流量、pcap包
	检测: waf、正则、流量解析、文件分析、威胁情报等等
	输出: 正常流量无动作,恶意流量阻断
EDR(系统的防护):
	输入: 进程事件、文件事件、主机API调用
	检测: 父子进程关系异常、非常规API调用、敏感文件读取
	输出: 异常阻断,杀死进程
WAF(网页端的防火墙):
	输入: api调用
	检测:是否包含xss、sql注入等关键字(包括AI检测)
	输出: 中断该次异常连接
webshell查杀:
	输入: 文本文件
	检测: 喊恶意关键字、数据进入敏感函数
	输出: 隔离、删除
```

<h4 style="color:red;">所有的输入都是恶意的，我们能掌控的只有输入</h4>

<h2 style="color:gray;">tip</h2>

```
我们在代码审计的时候,一定要紧紧抓住输入点,然后根据语言的特性，跟踪传播链,看看是不是有撸点
```

### 总结

```
1.使用术用体的方式看待事情
	术:就是对工具的时候,我们可能并不知道原理，但是我们会用
	用:对原理有一定的理解,可以从原理上知道为什么要这么用
	体:是一种思想的体现,不但懂原理,还能抽象出规律

2.代码审计要紧紧抓住输入点
	a.看能不能实现让数据流去改变控制流
	b.业务逻辑可能产生的问题点有哪些,如何根据污点分析快速筛选出有问题的业务(这个不能纸上谈兵)
```



